# Frontend RAG Integration

This directory contains the frontend components for the RAG (Retrieval-Augmented Generation) integration with the Docusaurus-based book UI.

## Overview

The RAG integration allows users to ask questions about the book content and receive answers generated by an AI agent with references to source documents. The system supports two query modes:

1. **Full-book questions**: Questions about the entire book content
2. **Selected-text questions**: Questions restricted to specific text selected by the user

## Architecture

### Components

- `RAGInterface.jsx`: Main component that integrates all functionality
- `QueryInput.jsx`: Text area for user questions with character counter
- `SubmitButton.jsx`: Button for submitting queries
- `LoadingIndicator.jsx`: Visual feedback during query processing
- `ResponseDisplay.jsx`: Displays answers and source references
- `ErrorDisplay.jsx`: Handles and displays various error states
- `QueryHistory.jsx`: Shows recent queries for navigation

### Services

- `api.js`: HTTP client with timeout and retry logic
- `query-handler.js`: Handles query submission with validation
- `cache.js`: In-memory caching for repeated queries
- `state-manager.js`: Manages query history and UI states
- `performance.js`: Monitors query processing times

### Utilities

- `response-parser.js`: Parses backend JSON responses
- `sanitizer.js`: Prevents XSS attacks in content
- `text-selection.js`: Captures selected text from the page
- `validators.js`: Validates input parameters

## Features

### Core Functionality
- Full-book question answering
- Selected-text context restriction
- Source reference display with page numbers
- Relevance scoring for sources

### User Experience
- Loading indicators during processing
- Comprehensive error handling with user-friendly messages
- Query history tracking
- Responsive design for mobile devices
- Keyboard navigation support

### Performance & Reliability
- Request queuing for multiple concurrent queries
- Caching for repeated queries (10-minute TTL)
- Retry logic with exponential backoff
- Performance monitoring and metrics

### Security
- Input sanitization to prevent XSS
- Content validation and length limits
- Safe URL handling

## Configuration

The integration uses the following environment variable:

- `BACKEND_API_URL`: URL of the RAG backend service (default: `http://localhost:8009`)

## Error Handling

The system handles several types of errors with specific user-friendly messages:

- **Network errors**: "Unable to connect to the question-answering service. Please check your connection and try again."
- **Backend errors**: "The question-answering service is temporarily unavailable. Please try again in a moment."
- **Empty responses**: "No relevant content found in the book for your question. Try rephrasing or asking about a different topic."

## Performance Requirements

- 90% of queries complete under 2 seconds in local setup
- Up to 10 queries per user session
- Docusaurus framework agnosticism maintained

## Integration with Docusaurus

The RAG interface is designed to be integrated into the Docusaurus sidebar or as a floating panel, maintaining compatibility with Docusaurus navigation and theming.

## Development

To run the integration tests:

```bash
node src/test-integration.js
```

This validates that all components work together correctly.